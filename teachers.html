<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<title>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ ‚Äî Cyber University</title>
</head>

<body>
<div class="bg-orbs" aria-hidden="true">
  <span class="orb orb-1"></span>
  <span class="orb orb-2"></span>
  <span class="orb orb-3"></span>
</div>

<div class="page">
  <header>
    <div class="logo">Cyber University</div>
    <nav>
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="students.html">–°—Ç—É–¥–µ–Ω—Ç—ã</a>
      <a href="schedule.html">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
      <a id="auth-link" class="nav-auth-btn" href="login.html">–í–æ–π—Ç–∏</a>
    </nav>
  </header>

  <h1 class="page-title reveal">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ SWE-201</h1>
  <p class="subtitle reveal">–ö–æ–º–∞–Ω–¥–∞ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–≤. –í—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ ‚Äî –¥–∞–∂–µ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.</p>

  <div class="teacher-section">
    <h2 class="section-title reveal">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</h2>
    <div id="teachersList" class="teacher-grid reveal"></div>
  </div>

  <footer class="reveal">Cyber University ‚Äî SWE-201 ¬© 2025</footer>
</div>

  <script type="module" src="script.js"></script>
  <script type="module">
    import { auth, db } from "./script.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { collection, query, onSnapshot, limit } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const link = document.getElementById("auth-link");
    const list = document.getElementById("teachersList");
    const loaderHTML = `
      <div class="muted center-row">
        <div class="spinner tiny"></div>
        –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π‚Ä¶
      </div>`;

    const fallbackAvatar = (name = "Teacher") =>
      `https://api.dicebear.com/7.x/identicon/svg?seed=${encodeURIComponent(name)}&backgroundType=gradientLinear&radius=50&flip=true&backgroundColor=14182a,1b0f2d&scale=95`;

    onAuthStateChanged(auth, (user) => {
      if (!link) return;
      if (user) {
        link.textContent = "–ü—Ä–æ—Ñ–∏–ª—å";
        link.href = "profile.html";
      } else {
        link.textContent = "–í–æ–π—Ç–∏";
        link.href = "login.html";
      }
    });

    const createTeacherCard = (data) => {
      const card = document.createElement("div");
      card.className = "teacher-card";

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.innerHTML = `<span class="icon">üë©‚Äçüè´</span>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å`;

      const photo = document.createElement("div");
      photo.className = "teacher-photo";
      const nameText = data.displayName || "–ë–µ–∑ –∏–º–µ–Ω–∏";
      photo.style.backgroundImage = `url('${data.photoURL || fallbackAvatar(nameText)}')`;

      const name = document.createElement("h3");
      name.className = "teacher-name";
      name.textContent = nameText;

      const role = document.createElement("p");
      role.className = "teacher-role";
      role.textContent = data.subject || "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å";

      const tagsBox = document.createElement("div");
      tagsBox.className = "tags";
      const tags = Array.isArray(data.tags) && data.tags.length
        ? data.tags
        : ["SWE-201", "Theory", "Practice"];
      tags.forEach((t) => {
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = t;
        tagsBox.append(tag);
      });

      card.append(badge, photo, name, role, tagsBox);
      return card;
    };

    function renderEmpty() {
      list.innerHTML = '<div class="muted center-row">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</div>';
    }

    function startTeachersFeed() {
      if (!list) return;
      list.innerHTML = loaderHTML;

      const q = query(collection(db, "users"), limit(400));
      return onSnapshot(
        q,
        (snap) => {
          list.innerHTML = "";
          let count = 0;
          snap.forEach((docSnap) => {
            const data = docSnap.data();
            const role = (data.role || "").toString().toLowerCase().trim();
            if (role === "teacher") {
              list.appendChild(createTeacherCard(data));
              count++;
            }
          });
          if (!count) return renderEmpty();
        },
        (err) => {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π:", err);
          list.innerHTML = '<div class="muted center-row">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.</div>';
        }
      );
    }

    startTeachersFeed();
  </script>
</body>
</html>
